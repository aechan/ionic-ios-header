{"version":3,"file":"header-content.js","sourceRoot":"","sources":["../src/header-content.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, Output, EventEmitter, TemplateRef, ViewChild, Renderer2, ElementRef } from '@angular/core';\r\nimport { Platform, IonContent, IonToolbar } from '@ionic/angular';\r\nimport { Subscription } from 'rxjs';\r\n\r\nconst HTML_TEMPLATE = `\r\n<ion-header style=\"box-shadow: none;\" class=\"statusbar\" #nav>\r\n  <ion-toolbar>\r\n    <ng-container *ngTemplateOutlet=\"navbarStart\"></ng-container>\r\n    <ion-title><span #fade>{{title}}</span></ion-title>\r\n    <ng-container *ngTemplateOutlet=\"navbarEnd\"></ng-container>\r\n  </ion-toolbar>\r\n  <ng-container *ngTemplateOutlet=\"headerEnd\"></ng-container>\r\n</ion-header>\r\n\r\n<ion-content fullscreen no-bounce>\r\n  <div #toolbar>\r\n    <h1 #header class=\"bold-header\">{{title}}</h1>\r\n    <ion-toolbar [hidden]=\"!search\" #searchbar>\r\n        <ion-searchbar\r\n        [(ngModel)]=\"query\"\r\n        (ionInput)=\"queryChange.emit(query)\">\r\n      </ion-searchbar>\r\n    </ion-toolbar>\r\n  </div>\r\n  <ng-content></ng-content>\r\n</ion-content>\r\n`;\r\n\r\n@Component({\r\n  selector: 'header-content',\r\n  template: HTML_TEMPLATE,\r\n  styles: [ '.bold-header { padding-top: 0px;margin: 0;padding-left: 15px;padding-bottom: 0px;font-size: 2.7em;font-weight: bolder;color: #111}',\r\n            '.statusbar{padding-top: calc(20px);padding-top: calc(constant(safe-area-inset-top) + 4px);padding-top: calc(env(safe-area-inset-top));min-height: calc(44px + 20px);min-height: calc(44px + constant(safe-area-inset-top));min-height: calc(44px + env(safe-area-inset-top)); }']\r\n})\r\nexport class HeaderContentComponent {\r\n\r\n  //Settings\r\n  @Input() title: string;\r\n  @Input() search: boolean = false;\r\n  @Input() forceIOS: boolean = false;\r\n  @Input() contentbox: any;\r\n\r\n  //Searchbar\r\n  @Input() query: string;\r\n  @Output() queryChange: EventEmitter<string> = new EventEmitter<string>();\r\n\r\n  //Templates\r\n  @Input() navbarStart: TemplateRef<void>;\r\n  @Input() navbarEnd: TemplateRef<void>;\r\n  @Input() headerEnd: TemplateRef<void>;\r\n\r\n  //Elements\r\n  @ViewChild('searchbar') searchbar: ElementRef;\r\n  @ViewChild('toolbar') toolbar: ElementRef;\r\n  @ViewChild('nav') nav: ElementRef;\r\n  @ViewChild('fade') fade: ElementRef;\r\n  @ViewChild('header') element: ElementRef;\r\n  @ViewChild(IonContent) content: IonContent;\r\n\r\n  //Events\r\n  private subscriptionScroll: Subscription;\r\n  private changes: MutationObserver;\r\n  @Output() public domChange = new EventEmitter();\r\n  @Output() appear: EventEmitter<boolean>;\r\n\r\n  //Utils\r\n  private ios: boolean = false;\r\n  private state: boolean = false;\r\n\r\n  private scrollContent: HTMLElement;\r\n\r\n  constructor(private renderer: Renderer2, private platform: Platform) {\r\n\r\n  }\r\n\r\n  //Life cycle\r\n  ngAfterViewInit(){\r\n    this.content.getScrollElement().then(scroll => this.scrollContent = scroll);\r\n    this.platform.ready().then(() => {\r\n      this.ios = this.platform.is('ios') || this.forceIOS;\r\n      if (this.ios) this.initIOS();\r\n      else this.initAndroid();\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(){\r\n    this.unsubscribe();\r\n  }\r\n\r\n  //Sub Management\r\n  unsubscribe(){\r\n    if(this.subscriptionScroll) this.subscriptionScroll.unsubscribe();\r\n    if (this.changes) this.changes.disconnect();\r\n  }\r\n\r\n  subscribe(){\r\n    this.contentChange();\r\n    this.subscriptionScroll =  this.content.ionScroll\r\n      .subscribe((data) => {\r\n        console.log(data);\r\n        if (!this.state && data.scrollTop >= this.element.nativeElement.offsetHeight-5){\r\n          this.state = true;\r\n          this.transitionToHeader()\r\n        }\r\n        if (this.state && data.scrollTop < this.element.nativeElement.offsetHeight){\r\n          this.state = false;\r\n          this.transitionToBody()\r\n        }\r\n      });\r\n  }\r\n\r\n\r\n  //Subscription logic\r\n  contentChange(){\r\n    if (this.contentbox){\r\n      this.changes = new MutationObserver((mutations: MutationRecord[]) => {\r\n        if (this.contentbox.clientHeight < this.scrollContent.scrollHeight) this.transitionToBody();\r\n      });\r\n      this.changes.observe(this.contentbox, {\r\n        attributes: true,\r\n        childList: true,\r\n        characterData: true\r\n      });\r\n    }\r\n  }\r\n\r\n  initIOS(){\r\n    this.contentChange();\r\n    this.renderer.setStyle(this.element.nativeElement, 'transition', 'opacity 1s linear');\r\n    this.renderer.setStyle(this.element.nativeElement, 'opacity', '1');\r\n    this.appear = new EventEmitter<boolean>();\r\n    let height = this.toolbar.nativeElement.clientHeight; //USE RULER\r\n    let styleheight = height + 'px';\r\n    this.renderer.setStyle(this.toolbar.nativeElement, 'min-height', styleheight)\r\n    this.renderer.setStyle(this.fade.nativeElement, 'opacity', '0');\r\n    this.renderer.setStyle(this.fade.nativeElement, 'transition', 'opacity 0.155s linear');\r\n    this.subscribe();\r\n  }\r\n\r\n  initAndroid(){\r\n    this.renderer.setStyle(this.element.nativeElement, 'display', 'none');\r\n    this.renderer.setStyle(this.fade.nativeElement, 'opacity', '1');\r\n    if (this.searchbar) this.renderer.appendChild(this.nav.nativeElement, this.searchbar.nativeElement)\r\n  }\r\n\r\n  transitionToHeader(){\r\n    this.renderer.setStyle(this.fade.nativeElement, 'opacity', '1');\r\n    if (this.searchbar) this.renderer.appendChild(this.nav.nativeElement, this.searchbar.nativeElement)\r\n  }\r\n\r\n  transitionToBody(){\r\n    if (this.searchbar) this.renderer.appendChild(this.toolbar.nativeElement, this.searchbar.nativeElement)\r\n    this.renderer.setStyle(this.fade.nativeElement, 'opacity', '0');\r\n  }\r\n\r\n  //Extra\r\n\r\n  debug(){\r\n    console.log('content', JSON.stringify(this.contentbox))\r\n    console.log('element:', this.element);\r\n    console.log('toolbar:', this.toolbar);\r\n    console.log('fade:', this.fade);\r\n    console.log('searchbar', this.searchbar);\r\n    console.log('nav', this.nav);\r\n  }\r\n\r\n}\r\n"]}